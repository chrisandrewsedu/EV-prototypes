# Main build configuration
[build]
  # Publish the root directory which contains index.html and subdirectories
  publish = "."

  # Build script that clones and builds ev-ui, then builds all projects
  command = '''
    echo "Cloning ev-ui..."
    git clone https://github.com/chrisandrewsedu/ev-ui.git ../ev-ui
    cd ../ev-ui
    npm install
    npm run build
    cd /opt/build/repo
    echo "Building prototypes..."
    npm run build:all
  '''

# Redirect rules for each project to handle SPA routing
[[redirects]]
  from = "/read-rank/*"
  to = "/read-rank/dist/index.html"
  status = 200

[[redirects]]
  from = "/treasury-tracker/*"
  to = "/treasury-tracker/dist/index.html"
  status = 200

[[redirects]]
  from = "/empowered-badges/*"
  to = "/empowered-badges/dist/index.html"
  status = 200

[[redirects]]
  from = "/data-entry/*"
  to = "/data-entry/dist/index.html"
  status = 200

# Set correct MIME types for JavaScript files
[[headers]]
  for = "/**/*.js"
  [headers.values]
    Content-Type = "application/javascript; charset=utf-8"
